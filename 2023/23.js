const input = `#.###########################################################################################################################################
#.#...#...#.........###.........###...#...###...#...#...#.....#...#...#...#...#...#...#...#...#...#...#...#.....###.....#...#...###.....#...#
#.#.#.#.#.#.#######.###.#######.###.#.#.#.###.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.###.###.###.#.#.#.#.###.###.#.#.#
#.#.#...#.#.......#.#...#.......#...#.#.#.#...#.#.#.#.#...#...#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#...#...#...#.#.#.#.#.###.#...#.#.#
#.#.#####.#######.#.#.###.#######.###.#.#.#.###.#.#.#.#####.###.#####.#.#.#.#####.#.#.#.#.#.#.#.#.#.#.#.#.###.###.###.#.#.#.#.#.###.#.###.#.#
#.#.#.....#...#...#.#...#...>.>.#...#.#.#.#...#.#.#.#.#.....#...#.....#.#.#.#.....#.#.#.#.#.#.#.#.#.#.#.#.#...#...#...#.#.#.#.#.#...#...#.#.#
#.#.#.#####.#.#.###.###.#####v#.###.#.#.#.###.#.#.#.#.#.#####.###.#####.#.#.#.#####.#.#.#.#.#.#.#.#.#.#.#.#.###.###.###.#.#.#.#.#.#####.#.#.#
#.#.#...#...#.#...#...#.#.....#.....#.#.#.#...#.#.#.#.#.>.>.#...#.#...#.#.#.#.#...#.#...#.#.#.#.#...#...#.#...#.#...###...#.#.#.#.###...#.#.#
#.#.###.#.###v###.###.#.#.###########.#.#.#.###.#.#.#.###v#.###.#.#.#.#.#.#.#.#.#.#.#####.#.#.#.#########.###.#.#.#########.#.#.#.###.###.#.#
#...###.#.###.>.#...#...#...#.......#...#.#...#.#.#.#.#...#...#.#...#.#.#.#.#.#.#.#.....#.#.#.#.......#...#...#.#.......#...#.#.#...#.....#.#
#######.#.###v#.###.#######.#.#####.#####.###.#.#.#.#.#.#####.#.#####.#.#.#.#.#.#.#####.#.#.#.#######.#.###.###.#######.#.###.#.###.#######.#
#.......#.#...#...#.....###...#.....###...#...#.#.#.#.#.....#...#.....#.#.#.#.#.#.###...#.#.#...#.>.>.#.#...#...#.......#.....#.#...#...#...#
#.#######.#.#####.#####.#######.#######.###.###.#.#.#.#####.#####.#####.#.#.#.#.#.###.###.#.###.#.#v###.#.###.###.#############.#.###.#.#.###
#.#...#...#.....#.#.....#...###.....#...#...###.#.#...#.....#...#...#...#.#.#.#.#.>.>.###.#...#...#...#.#...#...#.....###...#...#.#...#...###
#.#.#.#.#######.#.#.#####.#.#######.#.###.#####.#.#####.#####.#.###.#.###.#.#.#.###v#####.###.#######.#.###.###.#####.###.#.#.###.#.#########
#.#.#...#.......#...#...#.#.........#...#.....#.#.#.....#.....#...#...###.#.#.#.#...#...#.#...#.......#...#...#...#...#...#...#...#.........#
#.#.#####.###########.#.#.#############.#####.#.#.#.#####.#######.#######.#.#.#.#.###.#.#.#.###.#########.###.###.#.###.#######.###########.#
#.#.#.....#...#...#...#.#.............#...#...#...#.......#...###.#.....#...#...#.....#.#.#.#...#...#####.....###.#...#...#.....#...#.......#
#.#.#.#####.#.#.#.#.###.#############.###.#.###############.#.###.#.###.###############.#.#.#.###.#.#############.###.###.#.#####.#.#.#######
#.#.#.......#...#...#...#.............###...#...#...........#.....#.#...#...#.........#.#...#...#.#...#...#...###.....###...#...#.#.#.#...###
#.#.#################.###.###################.#.#.#################.#.###.#.#.#######.#.#######.#.###.#.#.#.#.###############.#.#.#.#.#.#.###
#.#.#.......###...#...###...............#...#.#.#...................#...#.#.#.......#.#.......#...###...#...#.......#...#...#.#.#.#.#...#.###
#.#.#.#####.###.#.#.###################.#.#.#.#.#######################.#.#.#######.#.#######.#####################.#.#.#.#.#.#.#.#.#####.###
#...#.....#.....#...#...###...........#.#.#...#.#.......#...............#.#.........#.....#...#.....#.............#.#.#...#...#...#.....#...#
#########.###########.#.###.#########.#.#.#####.#.#####.#.###############.###############.#.###.###.#.###########.#.#.#################.###.#
#.........#.....#...#.#.#...#.......#...#...#...#.#.....#...............#.......#...#...#...###...#.#...........#.#.#...#.....#...#...#...#.#
#.#########.###.#.#.#.#.#.###.#####.#######.#.###.#.###################.#######.#.#.#.#.#########.#.###########.#.#.###.#.###.#.#.#.#.###.#.#
#...........###...#...#.#.#...#...#...#...#.#...#.#...#...###...###.....#.......#.#...#.#...#.....#.#...........#...###...###...#.#.#.###...#
#######################.#.#.###.#.###.#.#.#.###.#.###.#.#.###.#.###.#####.#######.#####.#.#.#.#####.#.###########################.#.#.#######
#...................#...#...#...#.#...#.#.#.#...#...#.#.#.#...#.#...#...#.......#.#.....#.#.#.....#.#.#.....#.......#.......#...#...#.......#
#.#################.#.#######.###.#.###.#.#.#.#####.#.#.#.#.###.#.###.#.#######.#.#.#####.#.#####.#.#.#.###.#.#####.#.#####.#.#.###########.#
#...#.............#.#.....###...#...###.#.#.#.#...#.#.#.#.#...#.#...#.#.###...#.#.#.#...#.#.#...#.#.#.#.#...#.#.....#...#...#.#.#...........#
###.#.###########.#.#####.#####.#######.#.#.#.#.#.#.#.#.#.###.#.###v#.#.###.#.#v#.#.#.#.#.#.#.#.#.#.#.#.#.###.#.#######.#.###.#.#.###########
###...#...........#.......#...#...###...#.#.#.#.#.#.#.#.#.#...#...>.>.#.#...#.>.>.#.#.#...#.#.#...#.#.#.#.....#.#...#...#...#.#.#...........#
#######.###################.#.###.###.###.#.#.#.#.#.#.#.#.#.#######v###.#.#####v###.#.#####.#.#####.#.#.#######.#.#.#.#####.#.#.###########.#
###.....#...........#.....#.#.#...#...###.#.#.#.#.#.#.#.#...#...#...###.#.#.....###...#.....#...#...#...#.......#.#.#.#.....#.#.#...#...#...#
###.#####.#########.#.###.#.#.#.###.#####.#.#.#.#.#.#.#.#####.#.#.#####.#.#.###########.#######.#.#######v#######.#.#.#.#####.#.#.#.#v#.#.###
#...#...#.#.........#...#...#.#.###...#...#.#...#.#.#.#.#.....#...#...#.#.#...#...#...#.....#...#.#...#.>.>.....#.#.#.#...#...#...#.>.#...###
#.###.#.#.#.###########.#####.#.#####.#.###.#####.#.#.#.#.#########.#.#.#.###.#.#.#.#.#####.#.###.#.#.#.#v#####.#.#.#.###.#.#########v#######
#.....#...#.#...#...###...#...#.#.....#...#.....#...#...#...........#.#.#.###.#.#...#.#...#.#.###.#.#.#.#.....#.#.#.#.###...#.....#...#...###
###########.#.#.#.#.#####.#.###v#.#######.#####.#####################.#.#.###.#.#####.#.#.#.#.###.#.#.#.#####.#.#.#.#.#######.###.#.###.#.###
#.........#...#.#.#...#...#.#.>.>.#######.......#.....................#.#...#.#.#.....#.#.#...###.#.#...#.....#...#.#.#.......###.#.....#...#
#.#######.#####v#.###.#.###.#.#v#################.#####################.###.#.#.#.#####.#.#######.#.#####.#########.#.#.#########.#########.#
#.....#...#...#.>.###...###...#.......#...#...###.....#...............#.....#...#.......#.......#...#.....#...#...#...#.........#.#.........#
#####.#.###.#.#v#####################.#.#.#.#.#######.#.#############.#########################.#####.#####.#.#.#.#############.#.#.#########
#...#.#.....#.#.....#...###...#.......#.#.#.#...#.....#.#.....#.......#...#...#...###...#...#...#.....#.....#...#.....#.........#.#.........#
#.#.#.#######.#####.#.#.###.#.#.#######.#.#.###.#.#####.#.###.#.#######.#.#.#.#.#.###.#.#.#.#.###.#####.#############.#.#########.#########.#
#.#.#.......#.#...#...#...#.#.#.........#.#.#...#.......#...#...###...#.#...#.#.#.....#...#.#...#.....#.#.......#...#.#.#...#####...#...#...#
#.#.#######.#.#.#.#######.#.#.###########.#.#.#############.#######.#.#.#####.#.###########.###.#####.#.#.#####.#.#.#.#.#.#.#######.#.#.#.###
#.#.........#...#.#.......#.#.............#.#.###...#...###.........#.#...#...#...........#.....#####...#.....#...#...#...#...#...#...#.#...#
#.###############.#.#######.###############.#.###.#.#.#.#############.###.#.#############.###################.###############.#.#.#####.###.#
#.........#.....#.#.....#...#.....#...#####.#...#.#.#.#.#.......#...#...#.#.#...#...#...#.......#.....#.......#...#...#...#...#.#...###...#.#
#########.#.###.#.#####.#.###.###.#.#.#####.###.#.#.#.#.#.#####.#.#.###.#.#.#.#.#.#.#.#.#######.#.###.#.#######.#.#.#.#.#.#.###.###.#####.#.#
#...#####...#...#.#.....#...#.###...#.......#...#.#.#.#.#.....#...#.....#.#.#.#...#.#.#.....#...#...#.#.......#.#.#.#.#.#.#.....#...#...#...#
#.#.#########.###.#.#######.#.###############.###.#.#.#.#####.###########.#.#.#####.#.#####.#.#####.#.#######.#.#.#.#.#.#.#######.###.#.#####
#.#...........###...###...#...#####...#.......#...#.#.#.#.....#.....#...#.#.#...#...#.....#...#...#.#.###.....#.#.#.#.#.#.#.....#.....#.....#
#.#####################.#.#########.#.#.#######.###.#.#.#.#####.###.#.#.#.#.###.#.#######v#####.#.#.#.###v#####.#.#.#.#.#.#.###.###########.#
#...#.......#...###...#.#.....#.....#...###...#.#...#.#.#.....#...#.#.#.#.#.#...#.......>.>...#.#.#.#.#.>.>.#...#.#.#...#.#.###.......#.....#
###.#.#####.#.#.###.#.#.#####.#.###########.#.#.#.###.#.#####v###.#.#.#.#.#.#.###########v###.#.#.#.#.#.#v#.#.###.#.#####.#.#########.#.#####
###...###...#.#.###.#.#.#.....#.........#...#.#.#...#.#...#.>.>...#...#.#.#.#.#.........#...#...#.#.#.#.#.#...###...#.....#.......#...#.....#
#########v###.#.###.#.#.#.#############.#.###.#.###.#.###.#.#v#########.#.#.#.#.#######.###.#####.#.#.#.#.###########.###########.#.#######.#
#.......#.>.#.#...#.#.#.#...#...#.......#...#.#...#.#.###...#.#.......#.#.#.#.#.......#.#...#...#.#.#...#...#####.....#...#...#...#.......#.#
#.#####.#v#.#.###.#.#.#.###.#.#.#.#########.#.###.#.#.#######.#.#####.#.#.#.#.#######.#.#.###.#.#.#.#######.#####.#####.#.#v#.#.#########.#.#
#.....#.#.#...###...#.#.#...#.#.#...###...#.#.#...#.#.###.....#.#...#.#.#.#.#.#.......#...#...#...#.....###.....#.......#.>.#...###.....#.#.#
#####.#.#.###########.#.#.###.#.###v###.#.#.#.#.###.#.###.#####.#.#.#.#.#.#.#.#.###########.###########.#######.###########v#######.###.#.#.#
#.....#...#...###...#.#.#.#...#.#.>.>.#.#.#.#.#...#.#.#...#.....#.#...#...#...#...........#.#...#...#...#.......#...........#.......#...#.#.#
#.#########.#.###.#.#.#.#.#.###.#.#v#.#.#.#.#.###.#.#.#.###.#####.#######################.#.#.#.#.#.#.###.#######.###########.#######.###.#.#
#.........#.#...#.#.#...#.#.###...#.#...#.#.#...#.#...#.....#...#...#####...#####...#...#.#.#.#...#...###...#...#.....#.......#...#...###...#
#########.#.###.#.#.#####.#.#######.#####.#.###.#.###########.#.###.#####.#.#####.#.#.#.#.#.#.#############.#.#.#####.#.#######.#.#.#########
#.........#...#...#.....#.#.#...#...#...#.#...#...#...#...#...#...#.....#.#...#...#.#.#...#...###...#######...#.....#...#.......#...#...#...#
#.###########.#########.#.#.#.#.#.###.#.#.###.#####.#.#.#.#.#####.#####.#.###.#.###.#.###########.#.###############.#####.###########.#.#.#.#
#...#.....#...#.........#...#.#.#...#.#.#.....#...#.#.#.#.#.....#.#.....#...#...###...###...###...#...#.....#.......###...#.....#...#.#.#.#.#
###.#.###.#.###.#############.#.###.#.#.#######.#.#.#.#.#.#####.#.#.#######.#############.#.###.#####.#.###.#.#########.###.###.#.#.#.#.#.#.#
#...#.###...#...#...#...#.....#.....#.#.......#.#...#...#...#...#.#...#...#.......#...#...#.....#.....#...#.#.........#.....#...#.#...#...#.#
#.###.#######.###.#.#.#.#.###########.#######.#.###########.#.###.###.#.#.#######.#.#.#.#########.#######.#.#########.#######.###.#########.#
#...#...#.....#...#...#.#.#...#.......#.......#.......#...#...###.....#.#.......#...#.#.#...#...#...#...#.#.#.......#.###...#.....#.........#
###.###.#.#####.#######.#.#.#.#.#######.#############.#.#.#############.#######.#####.#.#.#.#.#.###.#.#.#.#.#.#####.#.###.#.#######.#########
#...#...#...#...#.......#...#...#.......#...###...###...#.....#.......#.......#.......#...#...#...#.#.#.#.#.#.....#...#...#.......#.........#
#.###.#####.#.###.###############.#######.#.###.#.###########.#.#####.#######.###################.#.#.#.#.#.#####v#####.#########.#########.#
#.#...#.....#.###.......#...#...#.....#...#.#...#...#.....#...#.#.....#.......###.....###...#...#.#.#.#.#.#.#...>.>.###...#.....#.....#...#.#
#.#.###.#####.#########.#.#.#.#.#####.#.###.#.#####.#.###.#.###.#.#####.#########.###.###.#.#.#.#.#.#.#.#.#.#.###v#.#####.#.###.#####.#.#.#.#
#...###.......#####...#.#.#.#.#.#.....#...#.#.#.....#...#.#...#.#...#...#...#...#...#...#.#...#...#.#.#.#.#...#...#...###...###...###.#.#...#
###################.#.#.#.#.#.#.#.#######.#.#.#.#######.#.###v#.###.#.###.#.#.#.###.###.#.#########.#.#.#.#####.#####.###########v###.#.#####
#...#...#...#...#...#...#.#.#.#.#.....#...#...#.#...#...#...>.>.#...#.....#...#.#...#...#.........#...#.#.#.....#...#...#.....#.>.###...#...#
#.#.#.#.#.#.#.#.#.#######.#.#.#.#####.#.#######.#.#.#.#######v###.#############.#.###.###########.#####.#.#.#####.#.###.#.###.#.#v#######.#.#
#.#...#...#...#.#...#...#.#.#.#.###...#.....#...#.#.#.###.....#...#...#.........#.#...#...#...###.....#.#.#...###.#.###.#.###...#.###.....#.#
#.#############.###.#.#.#.#.#.#.###v#######.#.###.#.#.###.#####.###.#.#.#########.#.###.#.#.#.#######.#.#.###.###.#.###.#.#######.###.#####.#
#.............#...#.#.#.#.#.#.#.#.>.>...#...#...#.#.#...#.....#.###.#.#.....#...#.#...#.#.#.#.#...#...#...###...#.#.#...#.......#...#...#...#
#############.###.#v#.#.#.#.#.#.#.#v###.#.#####.#.#.###.#####.#.###.#.#####v#.#.#.###.#.#.#.#.#.#.#.###########.#.#.#.#########.###.###.#.###
#.......#...#...#.#.>.#.#.#.#.#...#...#...#...#...#.#...#...#.#...#.#.....>.>.#.#.#...#.#.#.#...#.#.....#.......#.#.#.....#...#.###.....#...#
#.#####.#.#.###.#.#v###.#.#.#.#######.#####.#.#####.#.###.#.#.###.#.#######v###.#.#.###.#.#.#####.#####.#.#######.#.#####.#.#.#.###########.#
#.....#.#.#.....#...###...#.#.....###...#...#.....#.#.#...#.#.#...#.....#...###...#...#.#.#.#.....#.....#.........#.....#...#...#...........#
#####.#.#.#################.#####.#####.#.#######.#.#.#.###.#.#.#######.#.###########.#.#.#.#.#####.###################.#########.###########
#.....#.#...........#...###.......#...#...#.......#...#...#.#.#.........#.#...###...#...#...#.....#.###.........#.....#.#.........#...#.....#
#.#####.###########.#.#.###########.#.#####.#############.#.#.###########.#.#.###.#.#############.#.###.#######.#.###.#.#.#########.#.#.###.#
#.#...#...........#...#.....#...#...#.......###...#...#...#...#...#...#...#.#...#.#.#.........#...#...#.......#.#...#...#.....#.....#...#...#
#.#.#.###########.#########.#.#.#.#############.#.#.#.#.#######.#.#.#.#.###.###.#.#.#.#######.#.#####.#######.#.###.#########.#.#########.###
#.#.#...........#...........#.#.#...#.......###.#...#.#...#...#.#...#.#.....###...#...#.......#...#...#.......#.....###...###...#...#.....###
#.#.###########.#############.#.###.#.#####.###.#####.###.#.#.#.#####.#################.#########.#.###.###############.#.#######.#.#.#######
#...#.........#...#...#...###.#...#...#...#...#.#.....###...#...#.....#...#.....#.......###...###...###...........#...#.#.#...#...#.#.#.....#
#####v#######.###.#.#.#.#.###.###.#####.#.###.#.#.###############.#####.#.#.###.#.#########.#.###################.#.#.#.#.#.#.#.###.#.#.###.#
#...#.>.....#.....#.#.#.#.#...#...###...#.....#.#.#...#...#...###.#...#.#.#...#.#.....###...#.#...#...#...#.......#.#.#.#.#.#.#.#...#...#...#
#.#.#v#####.#######.#.#.#.#.###.#####.#########.#.#.#.#.#.#.#.###v#.#.#.#.###.#.#####v###.###.#.#.#.#.#.#.#.#######.#.#.#.#.#.#.#.#######v###
#.#...###...#...###.#.#.#.#...#.#...#.......###.#.#.#.#.#.#.#.#.>.>.#.#.#...#.#.....>.>.#...#.#.#.#.#.#.#.#.....#...#.#.#.#.#.#.#.#.....>.###
#.#######.###.#.###.#.#.#.###.#.#.#.#######v###.#.#.#.#.#.#.#.#.#v###.#.###.#.#######v#.###.#.#.#.#.#.#.#.#####.#.###.#.#.#.#.#.#.#.#####v###
#.#.....#.#...#.#...#.#.#.#...#...#.#.....>.>.#.#.#.#...#...#...#.#...#...#...#...#...#...#.#.#.#.#.#.#.#.###...#...#.#.#.#.#...#.#.#.....###
#.#.###.#.#.###.#.###.#.#.#.#######.#.#####v#.#.#.#.#############.#.#####.#####.#.#.#####.#.#.#.#.#.#.#.#.###v#####.#.#.#.#.#####.#.#.#######
#.#.#...#...#...#...#...#.#.#.......#...#...#...#...###...#...#...#.....#.#.....#...###...#.#.#.#.#.#.#.#...>.>.#...#.#.#.#.....#...#.......#
#.#.#.#######.#####.#####.#.#.#########.#.#############.#.#.#.#.#######.#.#.###########.###.#.#.#.#.#.#.#####v#.#.###.#.#.#####.###########.#
#.#.#.......#.#...#...###...#...........#.........###...#...#...#...###.#.#...........#...#.#.#.#.#.#.#.#.....#.#...#.#.#.#.....###...#.....#
#.#.#######.#.#.#.###.###########################.###.###########.#.###.#.###########.###.#.#.#.#.#.#.#.#.#####.###.#.#.#.#.#######.#.#.#####
#.#.#.......#...#.#...#.........#...#...#.........#...#...#.....#.#.#...#.#...........###...#.#.#.#.#...#.....#.#...#...#...###...#.#.#.....#
#.#.#.###########.#.###.#######.#.#.#.#.#.#########.###.#.#.###.#.#.#.###.#.#################.#.#.#.#########.#.#.#############.#.#.#.#####.#
#...#...........#.#.###.......#.#.#...#.#.......###.#...#.#.###...#.#.....#.................#.#.#.#.#.........#.#.......#.......#...#.#...#.#
###############.#.#.#########.#.#.#####.#######.###.#.###.#.#######.#######################.#.#.#.#.#.#########.#######.#.###########.#.#.#.#
###.............#...#...#...#.#.#.....#.#...#...#...#.#...#.#.....#...#.....................#...#...#.........#.........#.......#...#...#.#.#
###.#################.#.#.#.#.#.#####.#.#.#.#.###.###.#.###.#.###.###.#.#####################################.#################.#.#.#####.#.#
#...#...............#.#...#.#.#.....#.#.#.#...###.....#.....#...#.....#.............###...#...........#.......#...#...#...#...#...#...###...#
#.###.#############.#.#####.#.#####.#.#.#.#####################.###################.###.#.#.#########.#.#######.#.#.#.#.#.#.#.#######.#######
#...#.#...#.........#.#...#...#...#.#.#.#.........#.......#...#...#...#.....#.....#.....#.#.........#.#.....###.#...#...#.#.#.......#...#...#
###.#.#.#.#.#########.#.#.#####.#.#.#.#.#########.#.#####.#.#.###.#.#.#.###.#.###.#######.#########.#.#####.###.#########.#.#######.###.#.#.#
###...#.#.#.........#...#.....#.#.#...#...........#.....#.#.#.#...#.#.#.#...#...#.........#...#...#.#...###...#.........#...#.......#...#.#.#
#######.#.#########.#########.#.#.#####################.#.#.#.#.###.#.#.#.#####v###########.#.#.#.#.###.#####.#########.#####.#######.###.#.#
#.......#...........#.......#.#.#.....#.....###...#...#.#...#.#.###.#.#.#...#.>.>.....#...#.#.#.#.#...#.......#...#...#.#.....#...#...###.#.#
#.###################.#####.#.#.#####.#.###.###.#.#.#.#.#####.#.###.#.#.###.#.#######.#.#.#.#.#.#.###.#########.#.#.#.#.#.#####.#.#v#####.#.#
#.#.................#.....#.#...#.....#...#...#.#.#.#.#.....#...#...#.#...#.#.#.......#.#.#.#.#.#...#.......#...#...#.#.#.#...#.#.>.#...#.#.#
#.#.###############.#####.#.#####v#######.###.#.#.#.#.#####.#####.###.###.#.#.#.#######.#.#.#.#.###.#######.#.#######.#.#.#.#.#.###v#.#.#.#.#
#.#.#...............#...#.#.###.>.>.#...#...#.#.#.#.#.#...#...#...###...#.#.#.#...#...#.#.#.#.#...#.#...###.#.......#.#.#.#.#.#.#...#.#...#.#
#.#.#.###############.#.#.#.###.###.#.#.###.#.#.#.#.#.#.#.###v#.#######.#.#.#.###.#.#.#.#.#.#.###.#.#.#.###v#######.#.#.#.#.#.#.#.###.#####.#
#...#.......###...###.#.#.#.#...###.#.#...#.#.#.#.#.#.#.#.#.>.>.#...###...#...#...#.#.#.#.#.#.#...#.#.#.#.>.>.#.....#.#.#.#.#.#.#.....#.....#
###########.###.#.###.#.#.#.#.#####.#.###.#.#.#.#.#.#.#.#.#.#####.#.###########.###.#.#.#.#.#.#.###.#.#.#.###.#.#####.#.#.#.#.#.#######.#####
#.....#.....#...#.#...#.#.#.#...###.#.#...#.#.#.#.#.#.#.#.#.....#.#.#...........#...#.#.#.#.#.#.#...#.#.#...#.#.#...#...#...#...###.....#...#
#.###.#.#####.###.#.###.#.#.###.###.#.#.###.#.#.#.#.#.#.#.#####.#.#.#.###########.###.#.#.#.#.#.#.###.#.###.#.#.#.#.###############.#####.#.#
#...#.#.....#...#.#...#...#.....#...#.#...#.#.#.#.#.#.#.#.#...#...#.#...#.....#...###.#.#.#.#.#.#...#.#.#...#.#...#.#...###...#...#.#.....#.#
###.#.#####.###.#.###.###########.###.###.#.#.#.#.#.#.#.#.#.#.#####.###.#.###.#.#####.#.#.#.#.#.###.#.#.#.###.#####.#.#.###.#.#.#.#.#.#####.#
#...#.......#...#...#.........#...#...#...#.#.#.#...#.#.#.#.#.#...#...#.#.#...#.#.....#.#.#.#.#.#...#.#.#.###.....#.#.#.....#...#...#.#.....#
#.###########.#####.#########.#.###.###.###.#.#.#####.#.#.#.#.#.#.###.#.#.#.###.#.#####.#.#.#.#.#.###.#.#.#######.#.#.###############.#.#####
#...#...#...#.....#.#...#.....#...#.###...#.#.#.....#.#.#.#.#.#.#...#.#.#.#...#.#.#...#.#.#.#.#.#...#.#.#.......#.#.#...#...#...#...#.#.#...#
###.#.#.#.#.#####.#.#.#.#.#######.#.#####.#.#.#####.#.#.#.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.#.#.###.#.#.#######.#.#.###.#.#.#.#.#.#.#.#.#.#.#
###...#...#.......#...#...#######...#####...#.......#...#...#...###...#...###...#...#...#...#...###...#.........#...###...#...#...#...#...#.#
###########################################################################################################################################.#`;

const sample = `
#.#####################
#.......#########...###
#######.#########.#.###
###.....#.>.>.###.#.###
###v#####.#v#.###.#.###
###.>...#.#.#.....#...#
###v###.#.#.#########.#
###...#.#.#.......#...#
#####.#.#.#######.#.###
#.....#.#.#.......#...#
#.#####.#.#.#########v#
#.#...#...#...###...>.#
#.#.#v#######v###.###v#
#...#.>.#...>.>.#.###.#
#####v#.#.###v#.#.###.#
#.....#...#...#.#.#...#
#.#########.###.#.#.###
#...###...#...#...#.###
###.###.#.###v#####v###
#...#...#.#.>.>.#.>.###
#.###.###.#.###.#.#v###
#.....###...###...#...#
#####################.#`.trim();

/**
 * @param {number[][][][]} graph graph[y][x] = [[x, y, dist], ...]
 * @param {boolean[][]} seen
 * @param {number} x 
 * @param {number} y 
 * @param {number} dist 
 * @param {number} max_dist 
 * @returns new max_dist
 */
function dfs(graph, seen, x, y, dist, max_dist) {
    if (y == seen.length - 1) {
        return Math.max(max_dist, dist);
    }
    for (const entry of graph[y][x]) {
        if (!seen[entry[1]][entry[0]]) {
            seen[entry[1]][entry[0]] = true;
            max_dist = dfs(graph, seen, entry[0], entry[1], dist + entry[2], max_dist);
            seen[entry[1]][entry[0]] = false;
        }
    }
    return max_dist;
}

/**
 * @param {string} input 
 * @param {1 | 2} part 
 * @returns 
 */
function solve(input, part) {
    const grid = input.split('\n').map(l => l.split(''));
    const graph = [];
    for (let y = 0; y < grid.length; ++y) {
        let row = [];
        for (let x = 0; x < grid[0].length; ++x) {
            row.push(null);
        }
        graph.push(row);
    }
    for (let y = 0; y < grid.length; ++y) {
        for (let x = 0; x < grid[0].length; ++x) {
            if (grid[y][x] === '#') continue;
            let adj = null;
            switch (part === 1 ? grid[y][x] : '.') {
                case '.':
                    adj = [[0, 1], [0, -1], [1, 0], [-1, 0]];
                    break;
                case 'v':
                    adj = [[0, 1]];
                    break;
                case '^':
                    adj = [[0, -1]];
                    break;
                case '>':
                    adj = [[1, 0]];
                    break;
                case '<':
                    adj = [[-1, 0]];
                    break;
            }
            graph[y][x] = [];
            for (const [dx, dy] of adj) {
                let nx = x + dx;
                let ny = y + dy;
                if (nx < 0 || nx >= grid[0].length || ny < 0 || ny >= grid.length) continue;
                if (grid[ny][nx] === '#') continue;
                graph[y][x].push([nx, ny, 1]);
            }
        }
    }

    for (let y = 0; y < grid.length; ++y) {
        for (let x = 0; x < grid[0].length; ++x) {
            if (!graph[y][x] || graph[y][x].length !== 2) continue;
            const [x1, y1, d1] = graph[y][x][0];
            const [x2, y2, d2] = graph[y][x][1];
            let n1 = graph[y1][x1].findIndex(e => e[0] === x && e[1] === y);
            if (n1 !== -1) {
                graph[y1][x1][n1] = [x2, y2, d1 + d2];
            }
            let n2 = graph[y2][x2].findIndex(e => e[0] === x && e[1] === y);
            if (n2 !== -1) {
                graph[y2][x2][n2] = [x1, y1, d1 + d2];
            }
        }
    }
    let seen = [];
    for (let y = 0; y < grid.length; ++y) {
        let row = [];
        for (let x = 0; x < grid[0].length; ++x) {
            row.push(false);
        }
        seen.push(row);
    }
    let answer = 0;
    answer = dfs(graph, seen, 1, 0, 0, answer);
    return answer;
}

console.log(solve(sample, 1));
console.log(solve(input, 1));
console.log(solve(sample, 2));
console.log(solve(input, 2));

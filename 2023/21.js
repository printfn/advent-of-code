let input = `...................................................................................................................................
........#..........#.#.....#......................#...#...#............#.#.....................#...##..#.........#...#.#...........
..............#...#.....#...##..........................#...............#..............#...#....#......#..#.#........#..#..........
...........#................................................................#..........#.....#.#......#........#...#...............
..#...#..#...........#....#...#...#....#.#...#.##........................#...#..#............#........#........#...................
....#...........#...........##.#.....#.....#...........#....................#.#.........#....#..................#...#..#....#......
.##..#.....#......#..#................#.#.##.................................#...............#........#..#..#...#............#.#...
...#.......##.#..........#.....#....##.......#.......................................................#.....##..#........#....#...#.
..#..........#....#........#..#.......#.......##..................#...............#.....#.......#.............#...#.....#..#.......
.............#......#.#..................#.#.......................##.#............#.........#...#.........#...............#..##...
....##..........#.................#............................##.....#.........#......#....#.............#..#.........#.........#.
......#....#.....#.......................#.#.....#.........#.........#..#............................#.........................#...
............#..#.............#..#....................................#............................#.#.#...................##.......
....#.....................#...#....#...##................#............##....................##.#............#.......#.......##.....
.....#....................#....#...........................................................#....#....#.....#.................#.....
..................................#.......#..................#........#.#...#...........#..#.............#..#.......#..##..........
...........#...........#..........#.......................##.......#...#...#..............................#.............#.....#....
..#.#..###...................................................#.#....##.........................#...................#..#....#.......
...........#..#....#........#..........................#.##....................................#.....#....##.......#.........#.....
..........#................#.#.......#............#.....#.#.....#......#...#................#...#..................#..........#....
......#...........#............#...#....##...........#.........#.........#..........................##.........#.......#...........
...#.#.............#..#........#.......................#..........#..............#.........#....#.........#...#.#..#.............#.
......#..#......#.#.#.................#..................................#...#....#.........#.#.#..............#.....#..#..#..#....
...#.......#.#..#..........#........#.#.........#.......#...#.....................#...........##..#.......#.......#................
...#...#.#..................#........#..............#...#....#.#.............#.......#...........................#......#..........
.....#......#.................................#.......#....#.........##.........................#...............#..........#...#...
..#......#..#........#.#........................#...#..#.#.....................#.#..#...........#.#............#...........#..##...
.#.....#.......#....#..........#.#............#..#.................#...........#..........................#...........#...#.#.#....
...................#........#.##............#..................#....##..#.#..............#............#......#..........#..........
....#........#...##............................#....#....#....#...............#.......................#...#........................
............#..................#.......#......#......#..............#.#..#.......#.................#...#....##...............#.....
..........#..........#..#.............##.#..........#..#................................................#................#.........
.....#..........#.......................#..........#..........................#......................#....................##.##.#..
..#............##......#.#............#...........................#..#............#........#.................#...........#.........
..............#...........#...........#........#........#.........#.........###.............#............#.#.......#...#..#........
...........#......................#......#............#..................#.......#.#.#.#..#..#.................................#...
.....#..#........................#..................#........................#..##.....#.#.....#.........................#.#.......
.........................................#........#.....#...........#.....#...#.....#...#.......#.........#.#......#...#........#..
....#....#...............................#.....#.......#.#...#....#......................#........##..............#.....#....#.....
.....#........#................#.....#...............#.............................#.........................#....#.#....#.#...#...
..............#..................##.....#..#.#.#...##...............................###............................#.#.##.#....#...
..##.........................#.......................................................#..........#...#.#.......#.......#....#.......
.##............#.#...........................#....#.....................##.......#..#.....##.....................#...#....#....#...
........#...................#........#...........#....#.....#......#..#.....#.........#.#.#.....#.....................##.......#...
.......................................#.#.................#..##........#.#........................................#..#...#..#.....
.........#....#............#...#...#......#...#.......#.....##....#......#..#..........#.#.......#........#........#........#..#...
...................................................#..........#.......#....#..............#..#...........#.........#..#..........#.
...........#...........#...#..#........#...#.................#....##......##..........##........#.....#...............#.......#....
...............................#..#............#.#..#.......#........#..##......#..#.................................#....##....#..
......#.....#.........#.....#.#.#..#..#..#......................#.#...#...#............#.##...#..............#.................#...
.#...................#...#......#..#.....#.....#........................##....#............#.......#.#........#....................
..........#...........................#..#..........#..#..............#...#..................#....#.........................#......
...#..#..............#..........#..#............#...........................#....................#.................................
........................#........#..##...............#.#......................##....##....#.........#..............................
......#...........#........#.................#............#............##.#............###....#................................#.#.
...#..............##.....................###.#.......#......#...#.#..........#.......#............##.##........##.#..........#..#..
......................#.#.#........#........#.#.#...#....#..........#.....#.....#.............#...###......#........#...........#..
.............#.#......###.....#.....##.....#.#...........#.#...................#..........#....##.........#....#................#..
....................#...#...#.....##.#..#.........#........#..............#.......#...#..#...#.....................................
..................#.......##.....#..........#................#.....#.#....#.........##.........##.......#.......#.#................
..................#.#...#....#............#......#..........#.##......#....#..............##........#..................#...........
.....................#.....#.#.........#......................#............#...........#..#...................#..#...#.............
.......#.....##.........#..#..............#.......................#................#..........#.#.......#..#..........#............
.............##..........#....#..........................#..###...#..#......###...##......##.#......#..#........#..................
.........#....#..#.....#....#...#.......#.....#.......................##..................##.#.....#.....................#.........
.................................................................S.................................................................
...........#...#....##..#..#................#.......#..#....#..#........#....................##.....#....#.................###.....
.........#...#..#....................#.......#....#...........#................................#................#.#..#.#...........
........................#.........#.#......#.#..............#.......##....................#.#..............#........#.#.#..........
...........#..#............#..##.....#...#..#..........#.......#.....#...............#..............#....#...........#...#.........
....................#..#...#.......#...#................#.........#....##.....#..##..........##.........#..#.#.##.###..............
................#..#...........................#..#........................................#...................#..#................
..#........................##.................#....................#.....#................#...........#.........#...#..............
.#.......................#..#...........##......#........................................#...............#.....................##..
.#...#..........#....#.....#.....#...#...#............#........................#.........#..#..................#...............##..
..................................#......#.......#.................................##..#..................#...#.............###....
.......#............#.......##..................#.#...............##....................#.........#...#....##...#.#................
...#...#..........##.#.........##.................#....#..................................#...#......##....#..............#........
.....#.....................##.......................#..#..................#..#.......#.....##..#.#....#.....##...............#.....
....#...............#.......#..........#.................#...............#..#........#.....#..............#......................#.
.#.#...#.....................................#.....#........#..........#..#..#....##.........#..............................#.#....
................................#...................#................#.#..........#.......#.....#...........................#..#.#.
.........................................#.#.#..........#...........#..............#.............#...........#...............#.....
.......#.............................#..#...#.......#.#..#.............#...#..................#........#...........................
..#...#.......................#...........#............#..............#.#............#.#..##.##.......................#..#.........
..........#...#...........##.........#.......##.............................#............#.........#....#.#..........#.........#...
............#.............................#................#..#....#....#.#.....#..........#.....#..#................#...........#.
...........#...................#.............................#.............#............................#....................#.....
................#.....................#.#...#..#.#.#...#....................#............#..##...................#...#........#..#.
....................#...............#..#.......#....#.........#...........#...#........#.........................#........#..##....
..#............##....#.......#..........#....#........#........#................................#.........................#..#.....
........#..........#.##............#.#....#.............#...........#.....#......#.......##.....#............#.#....#............#.
...#..................#..............#...........#.#...#...................#...#...................#..........##..#................
.........#.#.........#....................#..........#..........#..#.#.......................#.#..............#..................#.
........#..##...#.#.#...............#.......#..........................#.............#...................#.............##......#...
............#..#..#.....#...........#................................#....##......#............#.........#..........##..........#..
............#.......#....#.............##.#.......#...#.........................#...........#..............#...##................#.
....#.##.....#...#.........................#...#......#.#.#............#........#....................................#.............
..#.........#...................................#......#.............................#........................#....................
......##...#...........#................#..#..............#..##...............#.#......#.........................#....##...........
...#......#............................#..#.....#............##...........###..#....#..............#......................#........
.#...............#...................................#.......................#.......................#.............#...##.....#....
...........#........#.##...#...............##...#...........................#.....#......#.............................#..#......#.
..#..............#.....#.#.................#...#..........#........#..............................##.....#......#...#......#.....#.
.#.......................#...................#.#....##.....#...................................#....#.......................#......
..........#...........#.#........#.#.........#.......#.........#.............#........#.........#.#......#..............#...#....#.
..#...#.#........#......................................#..........#.#............................................#.......#........
.............#....#..............##.#..................#......#............#....#...............#..........#.......#.#....#...#....
...#.......#.......##.....#...#....#....................#.............#..#..........................#......................#.....#.
...#.......#.........#..#...............#.......................#.#..##.#.#...#...............#.#.#...........#..........#.........
.#....................#...#........#.............##......................##................#........#..................#.#..#......
..............#.#....................###.................#.....#..........##................#......##.#.#....#..........#..........
...........#...........#.......#...........#..........................#.....................#.......#.#.....#..........#.........#.
...........#..#..#...#.....................................#.#.............#.............#....#..##.........#..#....#.....#........
........##..#..#..............................................##......#....#..........#...................##..#.#...............#..
.....##..#..#.....#...............#.#.#..#................#...#.....#...#...#.........#.#....#..........#.................#........
..................#.#..............#........................##..#.......#.##......................#.........#.#.........#...#......
.#..#...................#.......................#.....................#.......................#...##...#.#....#...#......#.........
....#......#...#...........#..#...........#....#........................#............#.................................#...........
...#...............#..........#..........#....................##....#..#..............#.............#.....#....##....#.............
...##....#.##.....#..............#..#....#...............................................##........#....#.......#.......#......#...
.....................#....#.....#.....#..........#.............#................................#........##.........#..............
..........#..#.....#....#...............#......#..................#..............#........#...#.#........#.#.............#..#......
......#.........#.##........#..................#..............#...............#..##...#......#....#...#...#............#......#....
.#...........................................#.......#.............#......................##......#.....#..#.......................
.................#....##.......#.................#................................#......#.....#..#.........#...........##....#....
.#................................#...#......#....#...#............................#............#.....##...........................
....#....#.#.......#.......#.#.....#.........#.........#.................#...........#.....#...........#..#.......#................
.....................................#.....#....#...........................#..#.#..........#.#........#........#......#.....#.....
.#...#..........#..#.................#.............#.........................................................................##....
...................................................................................................................................`.split('\n').map(l => l.split(''));

let sample = `...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........`.split('\n').map(l => l.split(''));

function solve(grid, part, steps) {
    let h = grid.length;
    let w = grid[0].length;
    let B = 100000000;
    let adj = (x, y) => {
        let result = [];
        if (grid[(y + B * h) % h][(x + B * w - 1) % w] !== '#') result.push([x - 1, y]);
        if (grid[(y + B * h) % h][(x + B * w + 1) % w] !== '#') result.push([x + 1, y]);
        if (grid[(y + B * h - 1) % h][(x + B * w) % w] !== '#') result.push([x, y - 1]);
        if (grid[(y + B * h + 1) % h][(x + B * w) % w] !== '#') result.push([x, y + 1]);
        return result;
    }
    let currentPositions = {};
    for (let y = 0; y < grid.length; ++y) {
        for (let x = 0; x < grid[0].length; ++x) {
            if (grid[y][x] === 'S') {
                currentPositions[`${x},${y}`] = 1;
            }
        }
    }
    for (let i = 0; i < steps; ++i) {
        let nextPositions = {};
        for (let pos in currentPositions) {
            let [x, y] = pos.split(',').map(n => parseInt(n));
            for (let [nx, ny] of adj(x, y)) {
                nextPositions[`${nx},${ny}`] = currentPositions[pos];
            }
        }
        currentPositions = nextPositions;
    }
    let sum = 0;
    for (let pos in currentPositions) {
        sum += currentPositions[pos];
    }
    return sum;
}

function solve2(grid, steps) {
    let a = steps % grid.length;
    let b = Math.floor(steps / grid.length);
    let n1 = BigInt(solve(grid, 1, a));
    let n2 = BigInt(solve(grid, 1, a + grid.length));
    let n3 = BigInt(solve(grid, 1, a + 2 * grid.length));
    let values = [n1, n2, n3];
    let diff = [n2 - n1, n3 - n2];
    let diff2 = diff[1] - diff[0];
    while (values.length < b + 1) {
        diff.push(diff[diff.length - 1] + diff2);
        values.push(values[values.length - 1] + diff[diff.length - 1]);
    }
    return values[b];
}

console.log(solve(input, 1, 64));
console.log(solve2(input, 26501365).toString());

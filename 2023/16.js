let sample = `.|...\\....
|.-.\\.....
.....|-...
........|.
..........
.........\\
..../.\\\\..
.-.-/..|..
.|....-|.\\
..//.|....`;

let input = `\\..|...................|........\\..............\\.................-......./........./...\\..........-......./...
........../...-/......\\.|............../.................\\...........\\........-.........|.....\\.-.|...........
...............-...........|......|...|......../.......\\............../.................................../...
..................................|............../..|.|.../............./..\\\\........|...|..............\\..|..
...........................-...-...-.......................-.....-.-....\\.......-............................/
........-...|.......|./../......................./.........................\\.................../.....\\........
\\..\\............-.\\.........|../................................\\....\\......................./.............-..
|\\...|....\\................\\...|........\\-..............|............\\.........\\.\\..|.|.......................
.....\\.........\\......|...-...............................-.............-../.../..--......\\.....\\.............
................|...........................|..........\\...........././.................../............../....
.............................\\......\\.../..|................---................-......\\....|...-............-.
..........|........./......\\|...|.......|........\\......\\....-....\\...-...../................/..-..../......-.
...|............./.................\\../....|...\\../.................|...|..|......|...........................
..................................-......../.....|............................................................
...................-.............|...-.........../...........................-..............-...............|.
..-.............../.............................-......-.....-.............|-...../....................../....
....||...../.........................................-...........................................--./-.......\\
...................\\..........-......./..............|\\........................../.-.|..............-..-/...|.
.-............-............../..-........../.......................\\...-...||........./.-.....-....../........
.......-.......-........................................../\\\\.......|......./../..\\........\\..-.........../../
....../../.......................\\.........\\-....\\.|..................\\......................./...-\\..........
\\.......-........\\...-.....................\\....-........./-...|......|.......-........................\\...\\..
...|\\.................................../..../..........|......-......../-..|......./..........\\../..|......-\\
..........\\...........................|..-........-/-......../....|...............................\\.....|.....
..............\\......-............................-.../........|........................./........-...........
.............-..\\.//.....................-....-......|....../....-............................/..............|
\\........../....|................./.....\\......\\.../.................|........\\............../................
.....-........-/|.........\\.....-./............|...\\.|......|.......|...................\\\\.....\\.............-
................|.-...-.....................|..........-....\\....\\......../...............................././
...........|.......\\..............\\......................................./........-..........................
...........................-..../............|............................|...........\\.......................
....................|..........|..................../...........\\.....|.........-............\\.\\...-..\\.......
................................-......-......\\.....-/......\\...\\................/................-...........
..|.....\\..\\......|../....................................................\\\\......-...../..../..............//
.........\\.................\\..\\..-.-..................\\.....\\..\\.....\\..........-.............................
...................\\............/..\\............|.............../..\\............................|\\.\\...../....
......|...............\\.......|......|/........|....-.......|...........-.../.\\....\\.....|./.......|..........
....\\/|................-.-..........|.................../..............|../-...|/..........|..................
..|........./-\\.............|...|............|......\\...................\\..../.........|...............|.-....
...................-................\\....|/....-...|......./....../..........-|............/......\\../..\\\\....
...........................-..........................................-...|.|................\\../...........-.
......../.....|.........-.......|........./-............|../.......|......-.-.-.......................-..|-...
.........|-...............|............./.....|........../..|........\\..........|/.............../-...........
...\\.....|..|...........\\....-...\\/.........................................|...................\\......-.-....
.../...-...|.............|.....\\...|.................................../..............\\.................../...
..........-.........../....|.....|..-.........../.................................-..................\\....\\/..
....../..............\\../......../.....-./....|../.\\....-.................../............................../.\\
......-.|..........................\\...............|.......-...-....../.............//...\\|................/..
................/.........|........................|......./..|......../-...........................\\....|....
........../...|.........\\...........-./......\\\\...........\\......|-......|...\\...............\\................
../.........................|.................-/...........--.........\\.../........................\\.........\\
........\\..|...|.............../...................-.........|.................\\..|......./.........-.....-|..
\\.../.......|.............|-.../.................\\...\\..........\\...|..........\\....../......-................
............|.|....\\..--............-/-..................../........................-../..\\..-................
.....................................|.................../.................................|..../..-......\\...
....|..............|..-.....|../.........................................|........\\.................|.........
..............\\..|...............\\....||........../................................\\................./.\\......
.....................-../......./....../.................................-............\\........../............
.....|.............../......-.\\.|........-...................|.....-........\\...-.............-....-.......-..
..../.....|..............\\../..............................\\........|....................|..............\\.....
....\\................-........\\../......|..../......................-.....|............../.../........../.....
....-...........................-.............|...........\\..|........|.......\\././.....|./..........\\........
/....................\\..............\\.............................-......................../\\......../....-...
......\\..................-............................................./.\\...../.............\\....-....\\.\\....
..................................\\-............................/.......|........................-|...........
.................../.../.......|./............\\.........\\....-.-....-../\\.........|........./...\\.............
......./.../....|...../|......................|.....|.....|.........|...........\\......-.\\..................|.
..././...........................|.......\\.|......-........./.................................................
........|.|.......................-....................././.......||...........|/....-....\\.......|......\\/...
.\\.\\.....|....\\......-....|...|.....//........|..-.........-.................-........./......................
.|.....................\\............-.................................|..../.............-....../.........../.
.|..\\..../...............\\..................../...\\............................-....../................../.|..
./.\\............................/.............-...../-................\\.........\\.............|...../.........
..........\\...............................\\............../.........\\.....-/........./|........................
.............\\..|....|..................................\\.........|./......................\\.........-........
../.....|-............|...\\................|...-....-........./........|.-..........\\.........................
........-............./...........--................../...............................|..|.\\....\\.............
\\.............-\\.........................-|......|/.........\\............/...........-.../.\\........\\..\\.../..
......................|........\\....-../.............|......|.-...................................-|../...-...
.............|...|.....-...........|.....-...............|...\\........................./..\\....\\..............
..............|.............-.........../....-..................................|......./........|............
...........|.-..../......................................\\....-...\\-......../........-..........-......-.....|
../...........-............-.../|...........-.-.............\\.............................|.............-.....
.........../...-............../........./...................................../......-.......\\\\...............
........................./.||......|...../.......|....|..................-..........|......\\..................
............/....-./..-...........|...-..........\\....../...\\/.......|\\.....\\....|........../..\\.\\............
.......................................-.../.......|............|........|...\\..........\\.....-...............
/..\\|.............-...-.................................\\........\\...................\\......|....-............
..................\\............../........................./.........|..........\\...\\......\\..........|......|
.../.................................................../...|............../....\\...\\...../........|.......-...
..................-.-..........................\\.................-......................-..\\.........-........
...................../\\.....\\.............\\.............../................\\.|............../........./.......
....................|../.\\./......................................-.../.......\\...............................
|........................-..............................................|...............................-.....
....\\.\\...........\\......|.........\\/|..|....|.....\\............-...../.............................\\\\........
......\\....|......\\|.....-..................\\........\\.......................-............-.|..............|..
....|.....././.......................|......../...........-.|............./......-.|....../.....\\......|....\\.
.........\\........|.......\\..........|........./..................\\.........................|................-
.....\\..........\\.....-......../...|-........../...\\/|........................................................
.../.....................\\../.........\\.|.........-..........\\...............................|...............\\
.........-...........................................-.|...........\\......//............../..|.\\............/.
.-|../...../.........|............./..........................|..-.\\......\\............\\................../...
../....../.................|..............\\.........|.\\......\\...../.......\\............\\./.......|....../..\\.
......../.-..-......\\.........................\\|...................................-....../...................
......................-....|........./\\................|......\\..-\\....../.......\\.................\\/.-\\......
............\\...|...............|............./...........................................\\....-.-............
\\.........|.............................|............/.........-.....\\........\\|...-..-..\\/.../......./.......
.............................\\.|...............\\....\\..\\-.....................\\......-...../......\\..../.....\\
..\\-......\\.\\........-........../........\\...............\\..................../....-....\\.\\.|.|...............
................|./........../.................................-.............|...................\\............`;

function move(dir, x, y) {
    switch (dir) {
        case 'right': return [x + 1, y];
        case 'left': return [x - 1, y];
        case 'up': return [x, y - 1];
        case 'down': return [x, y + 1];
    }
}

function solve(data, initialx, initialy, initialdir) {
    const grid = data.split('\n').map(l => l.split(''));
    let beams = new Set();
    let allbeams = new Set();
    beams.add(`${initialx},${initialy},${initialdir}`);
    let energised = new Set();
    let idx = 0;
    while (true) {
        ++idx;
        if (idx > 1000) break;
        let nextBeams = [];
        for (let beam of beams) {
            let [x,y,dir] = beam.split(',');
            x = parseInt(x);
            y = parseInt(y);
            if (x < 0 || y < 0 || y >= grid.length || x >= grid[y].length) {
                continue;
            }
            const key = `${x},${y}`;
            if (!energised.has(key)) {
                // console.log(x, y, dir);
                energised.add(key);
            }
            switch (grid[y][x]) {
                case '/':
                    switch (dir) {
                        case 'right': dir = 'up'; break;
                        case 'left': dir = 'down'; break;
                        case 'up': dir = 'right'; break;
                        case 'down': dir = 'left'; break;
                    }
                    nextBeams.push({x, y, dir});
                    break;
                case '\\':
                    switch (dir) {
                        case 'right': dir = 'down'; break;
                        case 'left': dir = 'up'; break;
                        case 'up': dir = 'left'; break;
                        case 'down': dir = 'right'; break;
                    }
                    nextBeams.push({x, y, dir});
                    break;
                case '|':
                    switch (dir) {
                        case 'left':
                        case 'right':
                            nextBeams.push({x, y, dir: 'up'});
                            nextBeams.push({x, y, dir: 'down'});
                            break;
                        case 'up':
                        case 'down':
                            nextBeams.push({x, y, dir});
                            break;
                    }
                    break;
                case '-':
                    switch (dir) {
                        case 'left':
                        case 'right':
                            nextBeams.push({x, y, dir});
                            break;
                        case 'up':
                        case 'down':
                            nextBeams.push({x, y, dir: 'left'});
                            nextBeams.push({x, y, dir: 'right'});
                            break;
                    }
                    break;
                case '.':
                    nextBeams.push({x, y, dir});
                    break;
            }
        }
        beams.clear();
        nextBeams.map(b => {
            [x, y] = move(b.dir, b.x, b.y);
            return { x, y, dir: b.dir };
        }).forEach(b => {
            let key = `${b.x},${b.y},${b.dir}`;
            if (!allbeams.has(key)) {
                if (!beams.has(key)) {
                    beams.add(key);
                }
                allbeams.add(key);
            }
        });
        // console.log(idx, energised.size);
        // console.log(grid.map((l, y) => l.map((c, x) => energised.has(`${x},${y}`) ? '#' : c).join('')).join('\n') + '\n\n');
    }
    // console.log(energised.size);
    return energised.size;
}

// console.log(solve(sample, 0, 0, 'right'));
console.log(solve(input, 0, 0, 'right'));

function part2(data) {
    let h = data.split('\n').length;
    let w = data.split('\n')[0].length;
    let results = [];
    for (let x = 0; x < w; ++x) {
        results.push(solve(data, x, 0, 'down'));
        results.push(solve(data, x, h-1, 'up'));
    }
    for (let y = 0; y < h; ++y) {
        results.push(solve(data, 0, y, 'right'));
        results.push(solve(data, w-1, y, 'left'));
    }
    console.log(results.reduce((a, b) => Math.max(a, b)));
}

// part2(sample);
part2(input);

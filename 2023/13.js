let data = `#....#.
#....##
.####..
.####..
#....##
#.##.#.
.####.#

.#...####.##..#
..#.###...#.##.
..#.###...#.##.
.#...####.##..#
.####..##.##..#
.####.#.###.##.
####..#.#######
#.......####..#
####.#.#.......
..#....##.#####
.##.##...##.###
..#.#.#.##.....
.....##.#..####
##..#.###..####
.##..#...######

..#..#.
#....#.
...##..
.##.#..
.####..
..#.#.#
....###
#..#.#.
#..#.#.
....###
..#.#.#
.####..
.##.#..

##.###...#.##
##.###...#.##
###.#####..##
##....#.##.##
#....#.#.####
.#....###....
#....#...####
.##.##.####..
..#.##.###.#.

#.#...#...##...##
#.#...#...##...##
#....##....#.....
##...##...##.##..
#..##..####....##
.....#.##..#.###.
#.......###..#...
..####.#.#.###..#
#..###.#.#.#####.
.....#.###....###
.....#.####...###

##....##.
##.##.###
.#.##.#.#
..#..#..#
........#
........#
..#..#..#
.#.##.#.#
##.##.###
##....##.
.##..#...

##..#..
...####
..#...#
..###..
##.####
##.#.#.
......#
....#.#
##.#.#.

##.#.##.#
...#..#..
.##...#..
.##...#..
.#.#..#..
##.#.##.#
.#...####
..#.#..##
...#...##
.#....#.#
.#....#.#

#.######.#..###
.#..##....#..##
####..####.##..
###.##.####....
####..#######..
.#......#.#.#..
.#......#..#...
#..#..#..#...##
#.#.##.#.##.###

.......##
#####.#..
#..##.#..
#######.#
....#####
.##......
####.#...
######.##
.....####
#..#.#...
.##.#..##

#.######.#.#.
##.##.###...#
#.....#....##
.#.......###.
.#.......###.
##....#....##
##.##.###...#
#.######.#.#.
#.#.##.#.#.##
..#.########.
..#.########.
#.#.##.#.#.##
#.######.#.#.

#.#.##.
..##..#
.#.##..
#..##.#
#...#.#
....##.
.#..##.
..#.#.#
..#.#.#
.#..##.
....##.
#...#.#
#..##.#

...#..#.##..#
..#.#..#.####
..#.#..#.####
...#..#.##..#
###..#..###..
...##....####
##..#..####..
##..#.##....#
#..#..#.#.#.#
##...#..#...#
...###..#.###

.##..#.##
##.###.##
##.###...
##..#.###
..#.#..##
##.###...
...######
###..####
..#...#..
..#....##
..####.##

......###..##
###.######.#.
..###...#..##
...##..#.....
...##.##.####
###..#.##.#.#
###..#.##.#.#
...##.##.####
...##..#....#
..###...#..##
###.######.#.

#..#.####
.#.#.###.
.###.###.
#..#.####
#...#...#
#...#...#
#..#.####

#.#...##.
##.##....
..#.##..#
..#.#.##.
#.##.#.##
###.##..#
####.....
##..#....
##.##....
##.##....
##..#....
####.....
###.##..#

#.#.#.##.
...#.#.##
...###.##
#.#.#.##.
#####..##
.#..##..#
####.#.##
....#.##.
.#...#.#.
.####.#.#
#..#.#.#.
..######.
..#..#...
#.#.#####
#.#.#####

.#.######
#...#....
#....####
#....####
#...#....
.#.######
##...#..#
###..#...
#.#.#####
..#.#....
.#.#..##.
.##.#....
.####.##.
#.##.####
#..######

###....###...
...#..#....#.
..........###
.###..###.#.#
...#..#...###
###.##.####..
###.##.###..#
#.#....#.#.#.
...####.....#
##......####.
##......##.#.
#.#.##.#.##..
#.##..##.#.##
#.#....#.#.##
#.#.##.#.##..
##......##.#.
##......####.

#...#.##..###
.#.#####.####
#..#..#######
#....##..#.##
.#.###..##.##
.##...##.....
.##.####.####
.##.####.####
.##...##.....
.#.###..##.##
##...##..#.##
#..#..#######
.#.#####.####

..#..####
#...#..#.
..#.##.#.
.#####...
#.##....#
#.##....#
.#####...
..#.##.#.
#...#..#.
..#..####
..##.####

.#.#.#..##.##
.#.####.....#
..##......#..
###.#..##..##
###.#..##..##
..##.#....#..
.#.####.....#
.#.#.#..##.##
.#.#.#..##.##

....#...###....##
.#.#..##..##..###
.#.#..##..##..###
....#...####...##
####.#..#...##...
......#.#..##...#
#....##.#.##...##
#..####.#....##.#
#..####.#....##.#
#....##.#.##...##
......#.#..##...#

#.#.#.#.##.##
#.#.#.#.##.##
.#..#.#.##.##
####.##.#...#
.###.##..###.
.###.#.#.##.#
#......##.##.
.##.#..###.##
####....####.
####....####.
.##....###.##
#......##.##.
.###.#.#.##.#

######.......
######.......
......#######
#####.##.#..#
####..#..#.##
##..##..#####
##..#####.###
#..#...##.#..
.###.##..#.##

#....##..
#######.#
#....#.##
.#..#..#.
##..##.#.
##..###..
##..###..
#....###.
......#.#
##..##...
##..##...
......#.#
#....#.#.

.........####
#..##..#.#...
.........#...
........##...
.#.##.#..####
#......######
#.####.#.####
.#....#.#.#..
...##....##..
#.#..#.##..##
#..##..#.....
.........#...
..#..#.......
.######.##.##
##....#.#....

....########.....
#..##......##..#.
#..##......##..#.
....########.....
..#.#..##..#.#..#
###.#......#.###.
#..#.##..##.#..#.
.....#...##......
#...###..###...#.
...##########...#
......####.......
...#...##...#....
##..########..##.

#..#####..#
###.#######
######.....
....#.#####
........##.
#..#..#.##.
######.#..#

###.###
##.#.#.
##.###.
..##.#.
...#...
####.#.
..#...#
######.
##....#
..####.
##.#...
##.###.
..#####
..##.#.
###..##
###..#.
..##.#.

.#.##.#.#
...#.....
...#.....
.#.##.#.#
.#.#.#..#
..#..#.#.
#..##.##.
.#.#..##.
##.....#.
###.#...#
###.#...#
##.#...#.
.#.#..##.
#..##.##.
..#..#.#.

...#.#..#
###.#####
.#.#.....
###.##..#
.##.#.##.
.#.#.#..#
.#...#..#
###..####
###.#....
###.#....
###..####
.#...#..#
.#.#.#..#
.#..#.##.
###.##..#

..#..#...#.
##....##...
.##..##.#.#
#......#.#.
##....###.#
#.#..#.##.#
.#.##.#..#.
#.####.#..#
#.####.#.##

#.##.##
.#..#..
#.##.##
.####..
..##.##
.####..
##..###
.####..
#....##
.#..#..
..##...

..#.#.#..
#...#..#.
#...#..#.
..#.#.#.#
..#.#.#.#
#...#..#.
#...#..#.
..#.#.#..
.###.....
.####.###
..#.###..
...#.#...
#.##....#
..####...
#####..#.
.#.##.#..
##..##.#.

.###.###..##...##
...####..#.##..#.
..#.#..##...###.#
#..#.##..####...#
.#..###...#.##.#.
.##..##.#.##.#.##
.##..##.#.##.#.##
.#..###...#.##.#.
#..#.##..####...#
..#.#..##...###.#
...####..#..#..#.
.###.###..##...##
..####...#..####.
..####...#..####.
.###.###..##...##

..##..###
##..##.#.
#######..
......#..
..##...##
#.##.##.#
......###

#######.#.###.##.
..##....##..#.#..
..##....##..#.#..
#########.###.##.
#..#####........#
.#....###.####...
.....####.##..#..
#..#.#.##...#....
#..#.#.##...#....

########.####..
#......#.#..###
#......#.#..###
########.####..
#.#.#.####..#..
..#...##...####
##...#.#..#.###
#.#.#.#......##
.##....##...###
####..#.##.###.
.#..###.#..#.##

.####....
.#...#.#.
.#...#.#.
.####....
##.#...##
#.##....#
#..#..#..
###..###.
###.###..
#.###.#.#
#.###.#..

##..##.#.
.####.###
#....###.
.......##
#.##.#..#
##..###..
......##.
.####.###
##..##...
#....###.
##..###..
#.##.#..#
#.##.#.##

#.....#..##
#.....#..##
.#.#..###..
..#.#..##.#
..##.######
#...#...#..
#.##.#.....
...###.#...
#.#...#.###
..#.##.#...
#..#.###.##
.##...##...
#.#..##..##
###.#######
..###...#..
..#.##.##..
##..##...##

#..##..
..#.##.
#.#.#..
#.#.#.#
..#.##.
#..##..
.#...#.
.###..#
.###..#

..##....#..##.###
.####....#.##..#.
.####....#.#...#.
..##....#..##.###
.......#.##.#####
.####....#####.##
##..##.###...##..
.......##...#.#.#
##..##..####....#
.####..##.##.####
########......###
.#..#...#.#.###.#
#.##.###.##......
..##...#.##.##...
#.##.##.#.#...#.#

#.#.#.###
..##....#
..#..#...
###.#.##.
.####....
#.####.#.
##.####..
..###.###
..##..###
#..####..
#..####..
..##..###
..###.###

.#.....
#..####
.##.##.
###.###
.....##
.....##
###.###
.##.##.
#..####
.#...#.
.#...#.
#..####
.##.##.

....##....#.##...
#........##......
..#.##.#...#...##
##......##.###.##
##.####.##...####
..##..##......#..
##.#..#..#..#..##
..#....#..###.###
.#......#..##.#..

#..#..###...#
#.#.##.######
#.#.##.######
#..#..###...#
####..#..##..
...#.#.#..##.
#...#.##...##
###.###.##..#
#..##.#...#..
#..##.#...#..
###.###.##..#
#...#.##...##
.#.#.#.#..##.

###.#.####.
####.#####.
##########.
###.#.####.
....#.#.#.#
...#.......
....#.#####
#####.#.##.
##.....###.
....#...#.#
##.#.##.#..
##.....####
..#.#...#.#
##......#..
.....#.#.#.

###....#..##.
####...#..##.
###.......#..
#..##....##..
##.##...#..#.
.#...#.##..#.
.#...####..#.
#...#..##.###
##..######.##
#.##.........
####..##.##.#
###...##.###.
###...##.###.

.#..###..##..
.#..###..##..
###....#....#
...#.####.#..
#.#..###...#.
..#.##.#.##..
..#.#..#.##..
#.#..###...#.
...#.####.#..
###....#....#
.#..###..##..

#..####..##
.########..
.#..##..#..
####..#####
..#....#...
.#.####.#..
#..####..##
#...##...##
.###..###..
.#.#..#.###
.#.####.#..

.#..##.
.#..##.
##.#.##
##.##.#
.....##
#.#.#.#
.#.###.
.#.###.
###.#.#
.....##
##.##.#
##.#.##
.#..##.

#.....#..#.
####.#....#
.##...#..#.
#...#.#..#.
#.###..##..
##.#...##..
###.#..##..
#.#.###..##
###...#..#.
.##.#......
.####......

###.###..##
###.###..##
##.#..##.#.
.#.#.#.#..#
..#....#.##
###.##..#.#
......#####
..###....#.
#.......#..
#.#.#.###..
.#.##.###..
..#.#....##
###..###...
#...##.##.#
#...##..#.#

####..######..#
.###..#.##.#..#
....##..##..##.
#.#....#..#....
..##..#.##.#..#
#.##..#.##.#..#
#...#..#..#..#.
####..##..##..#
.###..######..#

.#.####.#..
.########..
.##.#..##..
#.#....#.##
#..#..#..##
#.#.##.#.##
.###..###..
#.#.##.#.##
..##..##...
.#.#..#.#..
.###..###..

####.##
.#....#
##.#.#.
..##.##
...#.##
#####..
.#.####
.#.####
#####..
...#.##
..##.##

#..####
.###.##
#..##..
#..####
.#...##
.###.##
####.##

.........##....
###..####..####
.#....#..##..#.
.##..##.####.##
.##..##......##
..####...##...#
.######......##
##.##.###..###.
.##..##.#..#.##
#..#...######..
..####........#
.##..##.####.##
.######..##..##

....#.##.##..
#.##.#.......
#..##.#.#.###
.##....###.##
#..###..#...#
....###.#####
#..##....##.#
####.#...####
.##.##...##.#
.##.##...##.#
####.#...####

#......##
.#.######
##.#.#...
#.###.###
..#####..
#......##
#......##
..#####..
#.###.###
##.#.#...
.#.######
#....#.##
##.#.####

###....#.
#..####.#
....##.##
.##.##.#.
.##.#...#
.##....##
.......#.
.......##
.##.##...
####...#.
.##.#.#..
.##..###.
.##..###.

#.##..#..#.
....###..##
#.#....##..
##.##..##..
##.#.#....#
..#...####.
..#...####.
##.#.#....#
##.##..##..
#.#....##..
....###..##
#.##..#..#.
.#.##.#####
#....##..##
..#.###..##

..#..##.#
....####.
...#...#.
#..##..#.
.#.##...#
#.#.#....
#...#.###
#..##.###
#.#.#....
..##.##..
....#####
....#####
..##.##..
#.#.#....
#..##.###
#...#.###
#.#.#....

##########...
###...#..#...
###.#.#..#...
##########...
##.#######.##
##.....#...#.
#####..#..##.
##.###.......
...#..##.#..#
..##...##.##.
####.#.#.##..

####.###..#
####.##.#.#
....###..##
##...#.#.#.
###.#..#..#
###.#..#..#
##...#.###.

..###...##...
...##.######.
##..###....##
...#.#......#
...###......#
##.###.####.#
.#....######.
.....#..##..#
..###########
###.#.######.
###..#......#

###.###.###...##.
##.##.######..##.
.#####..#.#.##..#
.##.#..##.##.####
..##..##.#...####
.###..##.#...####
.##.#..##.##.####
.#####..#.#.##..#
##.##.######..##.

....##.
#.#.#.#
..##...
.#.#.##
.#.#.##
..##...
#.#.#.#
....##.
##..#..
.#..#..
....##.

..###......
.#.##...##.
##.#..###..
##.#..###..
.#.##...##.
..###..#...
..####..#.#
.##...#...#
.##...#...#
..####..#.#
..###..#...
.#.##...##.
##.#..###..

..##..#.#..#.#.
##..#####..####
##..####....###
.#..#..######..
##..####....###
.#..#.########.
##..##........#
..##....####...
#.##.#.#.##.#.#
######.#....#.#
.####....##..#.
.......#....#..
.####.#.#..#.#.

..#...#######
.#..##..####.
....#..#.##.#
.....##.####.
#...##.......
##..##.######
#.#.#....##..
.###.##.#..#.
.##..#.#.##.#
.##..###.##.#
.###.##.#..#.

.###..#...##..###
##...#.#.#....#..
##...#.#.#....#..
.###..#...##..###
#.###..##....#..#
#..##.#######.#.#
..####..#.####...
.#...#.##...##.#.
.#...#.##...##.#.
..####....####...
#..##.#######.#.#
#.###..##....#..#
.###..#...##..###

####.#...
.....####
#######.#
....#...#
.....#.##
....##.##
####.#..#
....#.#.#
.....#...
.....###.
......###
.##...#.#
....#..##

##.#.######.#
....#..#..##.
..#####.###.#
###.###..#.##
###.####.####
..#.##.#..#.#
#####...#..##
####.#....#.#
###..#....#.#
#####...#..##
..#.##.#..#.#
###.####.####
###.###..#.##

.#.#..##..#.#..
..###.....##...
...###..###....
#.##......##.##
.##........##..
.#...#..#...#..
####.#..#.#####
##.###..###.###
.#.#.#..#.#.#..
.#.#.####.#.#..
....######.....
.###..##..###..
##..#.##.#..###
.##.######.##..
.#..........#..
##..######..###
.#..........#..

#.....#.###..
..##..##...#.
###.##.#..#..
.#.###.####.#
.#.###.######
.#.###.######
.#.###.####.#

##.##....##
##.##....##
#.###....##
##..#.##.#.
#.###.#####
.#.#.#..#.#
#.##.####.#
..##.#..#.#
###.##..##.
#...######.
##..#.##.#.
#....####..
....#....#.
.#.#..##..#
#...#....#.

#..####
#...###
.#..#..
#....##
.#.....
.##..##
..#.#..
.....##
#.##.##
.#.##..
.#.####
#....##
#..#...

##...#...
.###.##.#
#.###.#.#
###..####
###..####
#.###.#.#
.###.##.#
###..#...
###..#...
.###.##.#
#.###.#.#

....####..###
...#####..###
.#.#..######.
...##..#..#..
#.#####....##
#.....##..##.
#....########
.#.#....##...
....##..##..#
.##...######.
#.##.#.#..#.#
......######.
#...#...##...

##.#.#.#...
..#.###..##
##....#..##
#.#.##.##..
#.#.##.##..
##....#..##
..#.###..##
##.#.#.#...
.......###.
.......###.
.#.#.#.#...
..#.###..##
##....#..##

##.#..#
###...#
#...##.
##.....
..#....
.##....
##.####
##.####
.##....
..#....
##.....

#..##..##..#..#..
#.########.#..#.#
.#...##...#.##.#.
..###..###......#
.###.##.###.##.##
.#.######.#.##.#.
##..#..#..######.
.###.##.###.##.##
.#..#..#..#.##.#.
.#..####..#.##.#.
...#....#........
....#..#.........
....#..#.........
..##.....#......#
.#.#.##.#.#.##.#.
#.#..##..#.####.#
###..##..###..###

##.##.#######
..#.....#..#.
#.###....##.#
.##.###......
..#.###.#..#.
..#.###.#..#.
.##.###......

##..#..##..
###.#.#..#.
#.####....#
.....##..##
#####..##..
....#.#..#.
..##.######
##.##.####.
#.#.#..##..
.####.####.
#.....####.
#...#.####.
.####.####.
#.#.#..##..
##.##.####.

##.###....####.
####.#.###.##.#
.##.###....##..
.##.#.###.#..#.
.....###.######
......#.###..##
.##.##.#.......
#####..####..##
#..#...########
####.######..##
....#..########

..#..#.###..#
.###.#...#..#
..#.###.#####
.##..##.#.##.
.##..##.#.##.
..#.###.#####
.###.....#..#
..#..#.###..#
.#..##....##.
##.##.#...##.
#.##.#...####

..###.#####
.#.########
.#####..#.#
.#....##.#.
.#....##.#.
.#####..#.#
.#.########
#.###.#####
#.###.#####
.#.########
.#####..#.#

.#..#.#.#
......##.
##..##.#.
##..##...
......##.
.#..#.#.#
##..##..#
##..###..
######.##
#######..
#.##.###.

.######
#......
#......
.##..##
.##..##
#......
#.#..#.

.#.....
#.....#
..##.#.
#.##...
..####.
#.#.#..
#.#.#..
..####.
#.##...
..##.#.
#.....#
.#.....
...#...
...##..
#......
#......
.#.##..

.....#.
#.##...
#.##...
..#..#.
..#..#.
#.##...
#.##...
.....#.
##..#.#

...##....
#.#..##..
#..###.##
###......
.#..#..##
#....#...
.##.#####
..#......
.#.....##
#.#..#.##
..##.####
..###.###
..#.#.###

.##..#.###.##
.##..#.###.##
.#...#..##.##
...#.#.#.##..
#..####.#...#
#.##.#...##..
.##.#.#..#.#.
....#.#####..
#.##.###...#.
..###.#####.#
..###.#####.#
#.##.###...#.
....#.#####.#

.##.##.#.###.
#..##.##..#.#
#.#######.##.
.....#..###..
.#######.#.#.
.#####.#.#.#.
.....#..###..
#.#######.##.
#..##.##..#.#
.##.##.#.###.
##.#.###.####
##.#.###.####
.##.##.#.###.

###..###.
.#....#..
.#....#.#
.#....#.#
.#....#..
###..###.
.#....#..
##.##.###
...##....
########.
#.####.##
#.####.##
.######.#
..####...
.#.##.#.#
#......#.
..#####..

..#..#..###
#.#.#...###
#.#.#...###
..#..#..###
#...#..##..
#..##.#....
.#.###.#.##
#.....#....
##.##.##..#
#..##.##..#
#.....#....`;

let sample = `#.##..##.
..#.##.#.
##......#
##......#
..#.##.#.
..##..##.
#.#.##.#.

#...##..#
#....#..#
..##..###
#####.##.
#####.##.
..##..###
#....#..#`;

function reflect(x, target, len) {
    return target + target - 1 - x;
}

function asserteq(a, b) {
    if (a != b) {
        throw new Error(`assertion failed, '${a}' != '${b}'`);
    }
}

asserteq(reflect(0, 4, 7), 7);
asserteq(reflect(1, 4, 7), 6);
asserteq(reflect(2, 4, 7), 5);
asserteq(reflect(3, 4, 7), 4);
asserteq(reflect(4, 4, 7), 3);

function testReflectionVertical(grid, target) {
    for (let y = 0; y < grid.length; ++y) {
        let reflected = reflect(y, target, grid.length);
        if (reflected < 0 || reflected >= grid.length) continue;
        for (let x = 0; x < grid[0].length; ++x) {
            if (grid[y][x] !== grid[reflected][x]) {
                return false;
            }
        }
    }
    return true;
}

function testReflectionHorizontal(grid, target) {
    for (let y = 0; y < grid.length; ++y) {
        for (let x = 0; x < grid[0].length; ++x) {
            let reflected = reflect(x, target, grid[0].length);
            if (reflected < 0 || reflected >= grid[0].length) continue;
            if (grid[y][x] !== grid[y][reflected]) {
                return false;
            }
        }
    }
    return true;
}

function calc(puzzle) {
    let result = [];
    for (let i = 1; i < puzzle.length; ++i) {
        if (testReflectionVertical(puzzle, i)) {
            result.push(100 * i);
        }
    }
    for (let i = 1; i < puzzle[0].length; ++i) {
        if (testReflectionHorizontal(puzzle, i)) {
            result.push(i);
        }
    }
    return result;
}

function solve(data, part) {
    return data.split('\n\n').map(puzzle => {
        puzzle = puzzle.split('\n').map(l => l.split(''));
        if (part === 1) {
            return calc(puzzle).reduce((a, b) => a + b);
        } else {
            let original = calc(puzzle);
            for (let y = 0; y < puzzle.length; ++y) {
                for (let x = 0; x < puzzle[0].length; ++x) {
                    let copy = JSON.parse(JSON.stringify(puzzle));
                    copy[y][x] = copy[y][x] === '#' ? '.' : '#';
                    let n = calc(copy).filter(x => !original.includes(x));
                    if (n.length != 0) {
                        return n[0];
                    }
                }
            }
        }
    }).reduce((a, b) => a + b);
}

console.log(solve(sample, 1));
console.log(solve(data, 1));
console.log(solve(sample, 2));
console.log(solve(data, 2));

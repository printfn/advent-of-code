let data = `>><<<<>><>><>><<>><<<<>><<<<>><<<>>><<>><>>><<<<>>>><<>><<<>>>><<>><<>>><>><<>>><<<<>><>>><<>><<>>><<<><>><<><<<<>><>>><<>>><<>><<<><<><<<>>>><<>>>><<<<><<<<>>><<<<>>><>><<<><>>><<<<>>>><<<>>><<<<>>>><>>>><<><<<<>>>><<<<>><<<<><<><<>>>><>>>><<<<>><>>><<<>>><<><<<>>>><<>><>>><>>><<><<>>>><<>><<>>>><<>>>><<<>>><<<>>><<<<>><<>>><>>>><>>>><<>>>><><<><<<<>>><<>><<<<>><<<<><<<<><<><<><>><<><<<><<<>>><<>>><<>><>>><<>>>><><<>><<<<><<<>>>><<<<>>>><<<<>>><<<>>><>>><<<<><<>>>><<>>><>><<<>>><<<>>><>>><><>><<<<>>><<<>>><>>>><<<<><><<<>>><<<>>><<<>>><<<>>>><<<>>><<<<><<<>>>><<<>><>>>><><>>><<<>><<<>>><>>><<<><<>><>>><<<<>><<<>>>><>><>>>><>>><<<<>>>><<>><<<><<>>><<>>>><<<<><<<>>>><>><<>><<<<>>><<><<<<><<<>><<<><>>><<>>>><<<<>><<>>>><<><>>>><<<>>><<<<><>><<>>>><>>><>><<<>><<<>>><<>>>><<<>>><>><><<<>><><<>>>><<<<>>>><<>>><<<<>>><<<>><>><><<>>><<<>>><<<><<>><<>>>><<<>><<>><<<<>>>><<<><<>>><>>><<<<>><><<<>><<<>><<><<>><<<>>>><<>>>><><<<>>>><<<><<><>>>><<<<>>>><>>><<<>>><>>>><<<<><><<><<<<><<<<>>><<><<<>>><<<><<<<>>>><<<>>><<<><>><>>>><>><<><<<<>>>><>><<<<>><<>>>><<>>>><<<<>>>><>>><<<<>>><<><<<>><<<<>>>><<<>><<<<>>>><<<<><<><>><<<>>><<<<>>><<<<>><<<>><<<>><<>><<<>><<<<>>><<<<>>><<>>><<<<>>>><<><<<>><>>><<<>>><<<>><<><>>><<><<>>>><<>>>><>>><>>><<<<><<>>><>>>><<<<><<<>>><>>>><>>><<<<>>>><>>>><><<>>><<<<>>><<>>><<<>>>><<<>>>><<<<>><><<>><<<>><<<>><<<<>>><<<<>><<<>>>><<>>><<<>>><>>>><<<<>>>><<>><>><<<<>>>><<<<>>>><<>>><<<>>><<<>>>><<>>>><<>><<>>>><<>>>><<<<><<<<>>>><<>><<>>><>>><<<><<<>>><<><<<<>>><<<>>><<>>>><<<><<<>>>><><<<>>><<<<><<>>>><<<>><>><<>>><>>><<<>>>><>>>><<<>><<>><<<<><<>><<<<>><<<<><><<<<>>><<<>>>><<<<>>><<<>>><<<>>>><>>><><>>><<>>><>>><<<><<<>><<>><<<<><<>>><<>>>><>>>><><<<<><<>><<<<>>><>><<>><<<<>><<<>>>><<<<>><<<>>><>>>><>><>><<<<>><>>>><>>>><<<>><<<>>>><<>><<>>><<<<><<<<><<>>>><<<<>><<<>>><<>>><><<<><<<>>>><>>>><>><>>><>>><<<<>>>><<<>>><>>>><<<<>>><<><<<><<>>><<><<<<>><>>><<><<<>>><<<<>><<><<<<>>>><<<><><<><>>><<<>><<<<><<><<<<>><><>>><>>>><<<<>><<<><<<>><<><<>><<<><<>>>><<>>>><<<<>>>><<<>>>><<>><>>><<>>><<<<><><<><<>>>><<<<><<<<><<<>>>><<<>>>><<>><<<>>>><<>>>><<><<>>>><>>>><<<>>><<<>><<><<>>><><><<<<>><<<>><<<>><>><<<>><<>>>><<<<>><>><<<<>>><<<<>>>><<<>>>><>><<<<>>><<<<><<<><<<<>><<<>>><<>>><<<<>><>>>><<>>>><<<>>><><>>><<<>>>><<<>>>><<<>>><>>><<<>>>><<<<>><<<<><<<<>>><<<<>><<>><>>><<<<><<><<<<>><><<>><<<<>>>><>>>><><<<<><>><<<<>>><>><<<<>><<<<>>><<><<<>><>>><<<>>><<<>>><<<>><>>>><<>>><<><<>><<<>>><<<<><<>><<<>><<><>><<>><>>>><>>><<<>>>><<<>>>><<<>><>><<<<>>><<><<>>><>>><<<<>>><<<><<<>>><>>>><<>>>><<>>><<<>><<<>><<<>>>><<>><<<<>><<>>>><<<<>>>><<>>>><<<<>>>><<>>><<<<>><<<<>><<<>>>><<<<>>><<<<><<<>>><>>>><<<<>><<<>>><<><<<>>><<<<>>>><<<<>><<>>><<<>><>>><<<>>>><<<><<<>>>><<><<<<>>>><>>>><<<<><<><<<<>><<<<><><>>><><<<<>>>><<<<><<>>>><<<<>>>><<<><<>>><<>>><><<<<>>><<>><<<>><<<<>>><<><<<>>><<>><<<><<<<>>>><>><<<>><>>><><<>>><<<<>><<><<>>><<>><<>>>><<><<>>><<<<>>><<>>><>><>>><<>><<<<>>><><<<>>>><<<<>>>><<<>>>><>>>><<><<<<><<><>><>><><<<<>>><<>><<<<><<<<>>>><><<<<><<>><<><<><<<>>><><<<>>><<<<>>>><><<>><<>>>><<><<>>>><<<<><<<><<>>><<>>>><<<>><<<>>>><>>><<>>>><<<<>>><><<<>><<<<>>><<<<>><<<>><<<<>><>>>><><>>>><<<>>>><<>>>><<><<>>><>>>><<>>>><<>><<><><<<<>><<<>><<<>><<<>>>><<<<>><<<<>><<<><<<><>>><><<>><<<>>><>>><<<>>><><>><<<<>>><>>><<>>>><>>>><>><<<<>>><<<><<<<><><<<>>><<>>><><<<><<<<>>>><>>>><<<<>>>><<<><<>><><<<<><>><>>><>>><<<<><><<<>>><<<<>><<<<>><<<><<<<>>><<>>><<>>>><<<>><<<<><<<<>>><>><<><<<<>>>><<<>>><<>>><<<<>><<<>>><>>><<<<>>><<<<>>><<<>>>><>><<<>>>><<><<><<<<>><<><<<><<<<>><<>>><>>>><<><>><<<>><<<<>><<>><>>>><<<<>>>><<>>>><<>>><<><<<><<<><<<<>><<<<>><<>>>><>>><>><<<>>><<<>>>><<<<>>><<<>>><<<<>>>><<<>>><>><<<<>>>><<<>>>><<<<>>>><<>>><<><<>>><<<>>><>><<<<>><<>>><<<>>><<>>><<>><>>>><<<><<<<><<>>>><<><<<<><<<><<<>><<<><><<<>>>><>><<><<<<>>><>>><<<<><<>><<<<><<<<>><<>>><<>>><>>>><<>><<<<>><>>>><>>><>>><<>>><<<<>><><<<>>>><<<<><<<<>>>><<<>><<><>>><<>>>><<<<>>>><<>><<>>><><<<<>><<<>>><<<>><<>><>><<<<>><<>><>>><<<>><><<<>>>><<<<>><<>><<<>><<<>>>><>><<<><<<<>>><<<>>><<<>>><<>><<<<>><>>><<>>>><<<><<<<><<>>><>>><>><<<<>><<><<<<><<<<>>>><<<>>>><<<>>>><<<><<>>><<>>><<<>>><>>><<<<>>><<<<>>>><<><<<<>><>>><>>><<<>>><<<<>>>><>>>><<<>>>><<><><<>><<<><<<>>>><<<><<<>>><>><<<<>><<<<>>><<<>>>><<<>><<<><<<<>>><<<<>>>><<>>><>>>><<<><<<<><<<>>><<>><<<>>><>>>><<<<>>>><<<<><<<>>>><<><>>>><<>>><<>>>><<><<<<><<<<>><<<<>>><<<<>><>><<<>>>><<>><>><>><<>>><<<>><<<><>>><<<<>>>><<<>>>><<<>>>><<>>>><>>><<<>>><<<<>><<<>>>><<>><<>>>><>><<<<><<>>>><<<<>><<<<>><<<>>>><>>><<>><><<>>><<><<>><><<<<>>>><<<<>>>><<>>>><<<>><<<<><>>>><<>><<<<>>><<>>><<<>><<<>>><<<<><<<>>>><>><><>>>><<<>>><<<<><<<<>>>><<<>>>><<<<>><<><<<<>>>><>><<<>>><<<>>>><>>><<<<>>><<<<>><<<<>><<<<><<<<>>><<>>>><<<<>>><>>><<>>>><>><<>>><<>>><<<<>>>><<<<>><<<><>>><<<>><<><>><<<><<<<>>>><<<>><><<<<><<<<><>>>><>>><<>><>>><><<<<>>><><<<><<><<<>>><><<<>>>><<><<><<<>>><<<><>><>>><<<><<<<>>>><<<>><<<><<<<>><<<<><<<<>>><<<>>>><<<<>>><><<<>><<<<>>><>>>><<<>>><<>>><<<>>><<<<>>><<<<><<<>>><<<<><<<<>>>><<>>><<<<>>><<>><><>><<><>><<<>>><<>><>>><>><<<><>>><><>>>><<<><<<>>><<>>><><<<<>>>><<<><<<>>>><<<<>><<>>>><<<<>>><<<<>>>><<>><<<>>><<<><<>>>><<<>><<<<><<>><<<<>>><<>>><<><>>><<>>>><<<<><<>><<<<>>><<<<>>><<<>><<<>><<><<<<><<<<>>>><><<<>><<>>>><<<><<<<>><<>>>><>>><<>>><<>><<>>>><<<<><<><<<<><<<<>>>><<<<><<>>><<<><<<<>>><>>><<<>><<<<>>><<<<>>>><>>>><>>><<<>>><<<<>>>><>><<<<>><<<<>><<<>>>><>>><<<<>>><<>><<<<><>>>><>>>><<>><<<<>><><<<<>><>><<<>>><<<>>>><<<><><<>>>><<><<<>>><<>>>><<<><<<<>><>>><>><<><>><<>>>><<<><<<<>><><>>><>>><<>>>><<>>>><<<<><<>>>><<<>>><<>><<<<><<>>>><<><><><<><<<<>><<<>>><<><<<>><<<><<<>>>><><<>>><<<<><<><>>>><<<<>>>><<<><<>>><<<>>><<<>>>><<<>>><>><<>>>><<<>>><<<><>><>>>><<<<>><<>><<>><<<>><<>>>><>>>><>><><<>><>>>><><>>>><>><<>><<><<<>>><<<>>>><>>><<<><<<>>><>>><<<<>>><<>>>><<<>>><<<<>>><<<><<<<>>>><<>>><<<<><<<>>>><<><<<<>>><<>>><<<>><>>><<<<><<>>>><>><>><<<>>>><>>><<<>><<><<><<><<<>><<<><>><<<>><<<><>><>>>><<>><>>><<<<>>>><<><>>><<<>>>><<<><><<>>>><<<>>><><<<<>>>><<>>>><>>>><>>><<<>>>><<>>><<>>>><<<<>>>><<<>><<<<>>><><><>>>><<<<>>>><<<>>><<>>>><<>><<>>><>>>><<<<>>><><<><<<>>>><<><<<<>>><<>>><<<<>><<<><<>>><<<<>><<>>><><<>>>><<<>><<<>>><<<<>>><<<>><<<<><<>><<<<><<><<<><<<>>>><>><<<<>>>><>><<<>>><<>>>><<>>>><<><>>>><<<<>><<<><<>><<<<>>><<<>>>><<><>>>><><<<<><<<<>>>><<<<><<<<>>><<<<><<><<<<>><<<><<<<><<>>>><<><<>>><<><<<>>><>>>><<><<<>>>><<<>>>><<<>>><<>><<<><<<<><<><<<>>>><>><<>>><><<<>>>><<<>>>><<<<>><<>>><<<>>><<<>>>><>>><>>><<>>>><<<><>><>>>><<<><<<><<<><<>><<<<>>>><<<<>>>><<<><<<>>>><<<>>>><>>>><><>>>><>><<>><<<<>>>><<>>><<<>><<<>>>><<<>><<>><<<>><<<>><<>>><><<>><<<>><<<<>><<<<>><<<<>>><>>><<<<><>><><>>><>>>><<<>>>><<>>>><<<<>><<<>><<>>><>>>><<<<>>><<<>>>><<>>>><<>><>>>><<<<>>><<>>>><>><<>>><<<<>>>><>>>><<>><<><<<>>><>><><<<<>>>><<<<><>>>><<>>><<<<>><<<><<>>><<<<><<<<>>>><<<<><<>>>><>>><<>><<><>><<<<><>><<<<>><<<<><<<><<><<>>><<<<>><>>><><><<<<><<<>>><>>><>>><>><<<<>>>><<<<><>>><<>><<>>><>>>><<<>>><<>><>><<<<>>>><<<>><>><<<<>>>><<<><<<>>><><<<<>>><>>>><<>><<<>>>><<<<><<<<>>><<<<>>>><<<<>>><<<>><><<<>><<>>>><<><><<<<>>><<>><<<>>><<<<>><<<<>>>><<<<>>><<<>>>><>>>><><<>>>><<<>><<<<>><<<>>><<<><>>><<<>>>><<>><<<>><<<<><>>><<<<>>>><>>>><<><>><<<<><<<>>><>>><<>><>><><<<<><<<<>>><<>>><><<<<>>>><<<>>>><>>><<>>><<<<>>><<>>>><<>>><<>>><<<>>>><<>>><<<><>>><<<>>>><<><<<<><<<<>>><<<>>>><<<<>>><<>><<>><<><<<><<<<>><<<>><><<>><<<<>>>><<<>><<<>>>><<<<>><>>><<<<><<<>><<>>>><<>>><>><<<>>><>>>><<<<>>><<<<>>><<>>><<>><<>>>><<<<>><>><>>><>>><<<>>><>><<<<>>><>>>><<>><<<<>>>><<<<>>><<<<>>><<<<>>>><><<>><<>>>><<<<><<>>>><<<>>><<<<>><<<<><<><<>><<<<>>>><<<>>><<<>>><>>><<<<>>><<><<<><<><<<><<>>>><><<>>><<<<>><<<>><<<<>>>><<<>>><>><>>><<<>>><<>><><<>>><<<<>>>><<<>>>><<<>>><<>>>><<<<><<><<>>>><><<<<>>>><>>>><<<>>><<<<>><<>>>><<<<>><<>><<>><><>>><<<><<<>>><><<<<><<>>>><<>><<><<<<>>><<<>><<>>>><<>>>><>>><<<><<<<>>>><<>><>><<<><<<>>><>><>><>><><<>>><>><>><<>>>><<>>>><<<<>>>><<<><>><>>><<<>><<<><>>><<<>>><<><<<><<<><<>>><<<<>><<<>>>><<>>><>>>><<>>><<<<>>>><<>>>><<>>>><<>>><<<>>>><<><><>><<<>>>><<<>>>><<<<>>><<<>><<<><<><<<<>>><<<<>><<<>>><>>><><<>>><>>><<<<>><<<<>><<<>><<<><<>><<<<><<>>><>>>><><<<<><>>><<>>>><<<>>>><<>><>><>>><<>><<<<>>>><<<<>><<<<>><<<>><<<>>><<>>><<><>>>><<><<<>>>><<>>><<<<><<<>><<><<<<>>><<>>>><<<<>><<<<>>>><<<<>><<>>><<<><<>><<<<>>><>>><<><<>>>><>><<<>>>><<>>><<><>>>><<>>><<<<>><<>><<<><<>>>><<<>>>><<<<>><<<<><<<<><<<>>><>>><>>><<<<>><><<<<>>>><<<>><<><<><<<>>><>><<<<>>><<><<<>>>><<>>>><<<<>>><><<<<><><<<<><<<>>>><<>><<<<>>><<<><<<<>><<<<>>>><<<>>>><<<>>><<>>><<<>><<>>><<>><<><><<<>><>>><<<<>>><<<<>>><<><><<><<>>><>><><><<<><<>><<>>><<<<>>><<<>>><><<<>>>><<<<>>>><<>><><<<><<<<>>>><>>><<<>>><<<><><<<<>>>><<>>><><<<<>><<<<>>><><<<<>>><<>><<<<>><<>>><<<<>>>><<<<>>>><><<>>><<><<<<><<<<>><<<<>>><><>><<<<><<><<>>><<<<>>>><<<<>><<<<><>><<<<>>><><<<>><>><<<<>>><<<<>><<>>>><<<>>>><<<>><>>>><>><<<<><>><<<<>>>><<<<>>>><<>>>><<<<>><>>><>>><>><<<>>><<><<<>>><><<<<>>>><><>>>><<<>><<<>><<>><>><>>><<<<><<<<>>>><>>>><<>><<<>>>><<<<>>><<<>>>><<><><<<>><<<<>>>><>><<>>>><<<>>>><<<><<>><<<><<<<>>><<<<>><>>><>>>><<>>><<<<>>><<<>>>><<<>>>><<<>>>><<><>>>><<>>>><><<<>>>><<<>>><>>>><>>><<><<>>><<>>><<><<<<>>><<<<>>>><<<<>>>><>>><<<>>><>>>><<><<<<>>><<<<>>>><<><<<<>><<><<<>>>><><>>>><<>>><<>>><>><<<<>><<<<><>>>><<<>>>><<<>><<<<>>><<<<>><<<<>>><>><<>><>>><<>>>><<><><<<>>><<<>><<<<>>><<><<<<>><<<>>>><<>>>><>><>>>><<>>><><>>>><>>>><<<>><<>><>><>><<<<><<<>>><<<>>>><<>><<><<<<>>><>><>>><>><><<<>><<<>>><<<>>>><<<<><<<>>><><>><<<>>><<<>>>><>>><<><<<<>><><<<><<<>>><<<<><<>>><>>>><<<<>>>><<<<><>><<><>>>><<>>><>>>><<<><>>><<<><<<<>><<<>><><<<>><><<>>><<>>>><>>><<>>>><<<<>><>>><>><<<>>><><<>>><<<<>><>>>><<<>><<<><><<><<<>>><>><<<>><<<<>><<>>><<<<><<>>><<<>><>><<<>>><<>>>><<<><<<>><<>>><<>><>>>><>><<<<><<<><<<<>><<>>>><<>><<<>>>><<>>><<<<>><>>><>><<<>>><<<>><<<<>>><>>><>>><<<<>>><<>>><<<>><<><<<>>><>>><<>>><<<<>><<>><><<<<><><<<<>>>><<<<><<<<><<<>>>><<<<>><<><<<>><<><>><<<<>>><<<>>>><<<<>><<>>><<<><<<<><>>><<<>>><<<<>><<<<>><<<<>>><<<<>>><<><<<<>>><<<><<>>>><<<>>><<<>><<<>><><<<>>><<>>><>>>><<<<><>>>><>>><<<<>>><>>><>><<<>>`;

//data = `>>><<><>><<<>><>>><<<>>><<<><<<>><>><<>>`;

let dataptr = 0;

const blocks = [
    { width: 4, height: 1, },
    { width: 3, height: 3, },
    { width: 3, height: 3, },
    { width: 1, height: 4, },
    { width: 2, height: 2, },
];

let currentBlock = 0;

function draw2d(img) {
    console.log('-------v');
    for (let i = img.length - 1; i >= 0; --i) {
        let row = '';
        for (let j = 0; j < img[i].length; ++j) {
            row += img[i][j];
        }
        console.log(row);
    }
    console.log('-------^');
}

function blockCoords(blockID, x, y) {
    switch (blockID) {
        case 0:
            return [[x, y], [x+1, y], [x+2, y], [x+3, y]]; // -
        case 1:
            return [[x+1, y], [x, y+1], [x+1, y+1], [x+2, y+1], [x+1, y+2]]; // +
        case 2:
            return [[x+2, y], [x+2, y+1], [x, y+2], [x+1, y+2], [x+2, y+2]]; // J
        case 3:
            return [[x, y], [x, y+1], [x, y+2], [x, y+3]]; // I
        case 4:
            return [[x, y], [x+1, y], [x, y+1], [x+1, y+1]]; // O
    }
}

function blockCollision(blockID, blockX, blockY, field) {
    for (let [x, y] of blockCoords(blockID, blockX, blockY)) {
        if (x < 0 || x >= 7) return true;
        if (y >= 0) {
            let j = field.length - 1 - y;
            if (field[j] !== undefined && field[j][x] == '#') return true;
            if (y >= field.length) return true;
        }
    }
    return false;
}

function getNextJetDir() {
    let res = data[dataptr++];
    if (dataptr == data.length) {
        dataptr = 0;
    }
    return res;
}

let field = [];

let numBlocks = 0;
let fieldHeight = 0;
function simulateBlock() {
    if (field.length > 1000) {
        field.splice(0, field.length - 64);
    }
    ++numBlocks;
    let blockID = currentBlock++;
    if (currentBlock == blocks.length) {
        currentBlock = 0;
    }
    let blockX = 2;
    let blockY = -3 - blocks[blockID].height;
    while (true) {
        let jetdir = getNextJetDir();
        if (jetdir == '<' && !blockCollision(blockID, blockX-1, blockY, field)) {
            --blockX;
            // console.log('moving left');
        } else if (jetdir == '>' && !blockCollision(blockID, blockX+1, blockY, field)) {
            ++blockX;
            // console.log('moving right');
        }
        if (!blockCollision(blockID, blockX, blockY+1, field)) {
            ++blockY;
            // console.log('moving down');
        } else {
            break;
        }
        // console.log('currently at', blockX, blockY);
    }
    // console.log('(1) placing at', blockX, blockY);
    while (blockY < 0) {
        field.push(['.', '.', '.', '.', '.', '.', '.']);
        ++blockY;
        ++fieldHeight;
    }
    if (blockY > 32) {
        console.log(blockY);
    }
    // console.log('(2) placing at', blockX, blockY);
    // y = 0 is the topmost row of the field
    for (let [x, y] of blockCoords(blockID, blockX, blockY)) {
        field[field.length - 1 - y][x] = '#';
    }
    // draw2d(field);
}

function cyclekey() {
    return dataptr + ',' + currentBlock;
}

const targetBlocks = 1000000000000;

for (let i = 0; i < 2022; ++i) {
    simulateBlock();
}
console.log(fieldHeight);


let cyclemap = {};

while (true) {
    simulateBlock();
    let k = cyclekey();
    if (cyclemap[k] === undefined) {
        cyclemap[k] = { numBlocks, fieldHeight };
    } else {
        const prev = cyclemap[k];
        // console.log('found cycle', k, prev, numBlocks, fieldHeight);
        const iterations = Math.floor((targetBlocks - numBlocks) / (numBlocks - prev.numBlocks));
        numBlocks += iterations * (numBlocks - prev.numBlocks);
        fieldHeight += iterations * (fieldHeight - prev.fieldHeight);
        break;
    }
}
while (numBlocks < targetBlocks) {
    simulateBlock();
}
console.log(fieldHeight);
